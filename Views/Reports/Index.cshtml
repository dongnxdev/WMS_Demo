@model WMS_Demo.Helpers.PaginatedList<WMS_Demo.Models.InventoryLog>

@{
    ViewData["Title"] = "Nh·∫≠t k√Ω kho";
    var currentAction = ViewData["CurrentActionType"] as string;
    var currentSort = ViewData["CurrentSort"] as string;
    var currentFilter = ViewData["CurrentFilter"] as string;
}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<style>
    /* Ch·ªânh l·∫°i style Select2 cho kh·ªõp v·ªõi Bootstrap */
    .select2-container .select2-selection--single {
        height: 31.25px;
        border: 1px solid #ced4da;
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 31.25px;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 31.25px;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>üìù Nh·∫≠t k√Ω giao d·ªãch kho</h1>
    <a asp-action="Report" class="btn btn-outline-primary">üìä Xem B√°o c√°o Hi·ªáu qu·∫£</a>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <form asp-action="Index" method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label fw-bold">Lo·∫°i giao d·ªãch</label>
                <select name="actionType" class="form-control select2-action" onchange="this.form.submit()">
                    <option value="">-- T·∫•t c·∫£ --</option>
                    <!option value="INBOUND" @(currentAction == "INBOUND" ? "selected" : "")>Nh·∫≠p kho (INBOUND)</!option>
                    <!option value="OUTBOUND" @(currentAction == "OUTBOUND" ? "selected" : "")>Xu·∫•t kho (OUTBOUND)</!option>
                    <!option value="ALL" @(currentAction == "ALL" ? "selected" : "")>T·∫•t C·∫£</!option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">T√¨m ki·∫øm</label>
                <div class="input-group">
                    <input type="text" name="SearchString" class="form-control" placeholder="T√¨m theo m√£ h√†ng, t√™n h√†ng..." value="@ViewData["CurrentFilter"]" />
                    <button class="btn btn-dark btn-industrial" type="submit"><i class="fa-solid fa-magnifying-glass"></i> T√¨m ki·∫øm</button>
                </div>
            </div>

            <div class="col-md-3">
                <label class="form-label fw-bold invisible">H√†nh ƒë·ªông</label>
                <a asp-action="Index" class="btn btn-secondary w-100">ƒê·∫∑t l·∫°i b·ªô l·ªçc</a>
            </div>
        </form>
    </div>
</div>

<table class="table table-hover table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["DateSortParm"]" asp-route-currentFilter="@currentFilter" asp-route-actionType="@currentAction" class="text-white text-decoration-none">
                    Th·ªùi gian <i class="bi bi-arrow-down-up"></i>
                </a>
            </th>
            <th>M√£ h√†ng</th>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["ItemSortParm"]" asp-route-currentFilter="@currentFilter" asp-route-actionType="@currentAction" class="text-white text-decoration-none">
                    T√™n h√†ng <i class="bi bi-arrow-down-up"></i>
                </a>
            </th>
            <th>H√†nh ƒë·ªông</th>
            <th class="text-end">SL Thay ƒë·ªïi</th>
            <th class="text-end">T·ªìn sau GD</th>
            <th class="text-end">Gi√° giao d·ªãch</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Count == 0)
        {
            <tr>
                <td colspan="8" class="text-center text-muted fst-italic py-4">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu n√†o ph√π h·ª£p.</td>
            </tr>
        }
        @foreach (var item in Model)
        {
            string badgeClass = item.ActionType == "INBOUND" ? "bg-success" : (item.ActionType == "OUTBOUND" ? "bg-danger" : "bg-warning");
            <tr>
                <td>@item.Timestamp.ToString("dd/MM/yyyy HH:mm")</td>
                <td>@item.Item?.Code</td>
                <td>@item.Item?.Name</td>
                <td><span class="badge @badgeClass">@item.ActionType</span></td>
                <td class="text-end fw-bold @(item.ChangeQuantity > 0 ? "text-success" : "text-danger")">
                    @item.ChangeQuantity.ToString("N0")
                </td>
                <td class="text-end">@item.NewStock.ToString("N0")</td>
                <td class="text-end">@item.TransactionPrice.ToString("N2")</td>
                <td class="text-center">
                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info text-white">Chi ti·∫øt</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                <a class="page-link" asp-action="Index"
                   asp-route-sortOrder="@currentSort"
                   asp-route-pageNumber="@(Model.PageIndex - 1)"
                   asp-route-currentFilter="@currentFilter"
                   asp-route-actionType="@currentAction">Tr∆∞·ªõc</a>
            </li>

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                    <a class="page-link" asp-action="Index"
                       asp-route-sortOrder="@currentSort"
                       asp-route-pageNumber="@i"
                       asp-route-currentFilter="@currentFilter"
                       asp-route-actionType="@currentAction">@i</a>
                </li>
            }

            <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                <a class="page-link" asp-action="Index"
                   asp-route-sortOrder="@currentSort"
                   asp-route-pageNumber="@(Model.PageIndex + 1)"
                   asp-route-currentFilter="@currentFilter"
                   asp-route-actionType="@currentAction">Sau</a>
            </li>
        </ul>
    </nav>
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
             $.fn.select2.defaults.set( "theme", "bootstrap-5" );
            // K√≠ch ho·∫°t Select2 cho class .select2-action
            $('.select2-action').select2({
                placeholder: "Ch·ªçn lo·∫°i giao d·ªãch",
                allowClear: true,
                width: '100%' // ƒê·∫£m b·∫£o r·ªông full √¥ ch·ª©a
            });
        });
    </script>
}